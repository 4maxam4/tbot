# Changelog

## [Unreleased]
### Added
- Reimplemented Logging. The following generators have been updated:
    * `htmllog`
    * `junit`


## [0.6.0-pre05] - 2018-09-26
### Added
- `verbosity` parameter for `log.message`
- `ignore_hostkey` flag for `SSHMachine`s

### Changed
- More robust completions

### Fixed
- Program name in help and version message was wrong
- Better error messages when a testcase file can't be loaded
- Selftests failing because sshd host key changes
- `GitRepository` failing to reset in `__init__`


## [0.6.0-pre04] - 2018-09-19
### Added
- `GitRepository.head`: Get the current position of `HEAD`
- `GitRepository.bisect`: Bisect the git repo to find the commit
  which introduced a bug.
- Show durations of testcase runs.

### Changed
- Moved package metadata into `__about__.py`
- Always show long version in documentation
- `shell.copy` can now copy from and to SSHMachines.


## [0.6.0-pre] - 2018-08-28
Version **0.6.0** is basically a complete rewrite of TBot.  A rough summary of changes:
- Be as *pythonic* as possible, the old version had a big issue of non pythonic patterns
  making things that should be easy difficult.
- More static guarantees. New TBot can guarantee even more when checking your testcases with
  a static typechecker.  A big new feature in that regard is static guarantee of never using
  a path with a wrong machine!
- Cleaner and much smaller codebase.  Every piece of code is written as small and pythonic
  as possible which has made the codebase much more manageable.
- Speedups! New TBot can complete its selfchecks in under 1s. This is possible because of a
  new channel API that no longer uses sleep unless absolutely necessary.
- Much more stable and predictable.  Even more care was taken in making TBot behave as predictable
  as possible and reducing side effects.


## [0.3.4] - 2018-08-09
### Added
- `TestcaseFailure` & `InvalidUsageException` exceptions

### Changed
- Better error message when testcase does not exist
- More explicit exceptions

### Fixed
- Fixed TBot ignoring failures while applying patches (#13)
- Fixed -d not being allowed between board and testcase (#6)


## [0.3.3] - 2018-07-20
### Added
- `uboot.shell.autboot-keys`: Custom key sequence for intercepting
  autoboot (#9)
- Warning if an invalid testcase file is in the path (TBot no longer
  refuses to do anything, in this case)

### Changed
- Made scp config settings consistent with ssh settings (#10)

### Fixed
- Fixed TBot still clogging the user's history with commands (#7)
- Fixed testcase files not being able to import local submodules
- Fixed TBot errors being shown when attempting testcase completion (#11)


## [0.3.2] - 2018-07-12
### Added
- Comments in files generated by `tbot-mgr` to explain
  config options
- `-s`, `--show` command line option to get information about
  testcases
- `warning` and `error` log message functions

### Changed
- Removed `ssh_command` and added `ssh_flags` instead. This allows TBot
  to have more control over ssh

### Fixed
- Fixed TBot hanging when SSH asks for a password
- Fixed git bisecting


## [0.3.1] - 2018-06-22
### Added
- `tbot-mgr`: A script for managing TBot configs
- Testcases for building Linux
- `interactive_build_uboot` and `interactive_build_linux`
- Selftests are now run as a pre-commit hook
- A dummy lab and board for running selftests
  that are as generic as possible
- ``linux.revision`` and ``uboot.revision`` config keys

### Changed
- git testcases now have a `rev` parameter for checking out a specific
  revision

### Removed
- DENX specific configs

### Fixed
- A crash while checking the config


## [0.3.0] - 2018-06-15
### Added
- **Buildhosts:** This release adds the ability to build U-Boot/Linux
  on a separate machine. This will reduce load on your labhost if multiple
  people are using it
- You can now disable documentation for a testcase by passing
  `doc=False` to `tb.call`
- Added `-i/--interactive` commandline flag that will make TBot wait for user
  confirmation for each command it wants to execute. Use this if you are unsure
  whether your testcase will do anything harmful, because you can intervene if a
  critical command has ie. wrong parameters
- Added `retrieve_build_artifact` and `tbot_clean_builddir` tasks
- Added a new config key `build.local` that defines the buildhost that is the
  labhost itself
- More tests in `check_config`
- Better documentation

### Changed
- `uboot_checkout` now checks out U-Boot onto the default buildhost by default
- U-Boot is built on the buildhost by defalt, you need to use `retrieve_build_artifact`
  to copy binaries to the labhost
- Renamed `tbot_check_config` to `check_config`

### Fixed
- Removed an unnecessary shell check from U-Boot tests
- Fixed TBot "leaking" from a with statement


## [0.2.4] - 2018-05-28
### Added
- pre-commit hook config, run `pre-commit install` to use these
  hooks.
- Checks for malformed commands (eg. running `exit` or a command that
  contains a `\n`)

### Changed
- Use flake8 instead of pylint
- Reformat using black

### Fixed
- Fix the config not being properly installed and thus TBot not
  working outside a development environment
- Small visual errors that were created when moving to the
  new logger


## [0.2.3] - 2018-05-16
### Added
- New singleton logger `tbot.log`
- Warning when trying to generate documentation
  from unsuccessful TBot runs

### Changed
- The old logger was replaced by a new singleton implementation.
  This solves a few issues where the logger was not available
  when it should have been. Also, logging is a prime example for
  where to use a singleton. This will ensure that stdout is only
  used in one place and things don't get messy ...

### Removed
- Old `tbot.logger` module and it's `LogEvent`'s
- `TBot.log`

### Fixed
- U-Boot bootlog was not shown in very-verbose logging
- Documentation links not working properly
- The interactive shells were not properly handling the
  receival of multiple bytes at once, this is fixed now
- Path expansion in completions is now handled properly


## [0.2.2] - 2018-05-15
### Added
- **Commandline testcase parameters**: You can now pass parameters
  to testcases from the commandline using the `-p` or `--param`
  commandline parameter
- Completions for logfile
- More config documentation
- `shell_utils.command_and_retval`: Run a command on a channel
  and get it's return code

### Removed
- `@cmdline` decorator. All testcases are now callable from
  the commandline, for some you will need to use the new `-p`
  option to work properly

### Fixed
- Completions for `-c` were not always properly handled
  (`=` messed with argument splitting)


## [0.2.1] - 2018-05-14
### Changed
- Disable writing to history when setting up a channel
- Implement cleanup in interactive testcases so user code can continue
  after finishing an interactive session

### Fixed
- Fix KeyErrors not displaying the full path to the failing key


## [0.2.0] - 2018-05-04
### Changed
- Use custom bash completions instead of argcomplete
- Make the HTMLLog generator use a template. Eases development
  and reduces clutter in the source file. Also, the html logs
  no longer depend on the existence of the css file
- Implement better quiet handling. Adjust the verbosity
  levels of some log messages to ensure they are displayed
  when they should be

### Fixed
- Fix testcase EXPORTS. Exports are now in a separate file
  that is loaded before everything else. This should fix
  some testcases not working because exports they depend on
  were loaded later
- Fix `call_then` not returning the function itself
